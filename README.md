# Pixonic Test

### Текст задания

Необходимо реализовать 2D игру про корабль, который летает в космосе. Платформы:
PC, Mac, Android, iOS.

Требования:
Космос это сетка из квадратных ячеек, корабль перемещается только по ячейкам через
WASD сквозь все возможные препятствия. Передвижение мгновенное.
Ячейка заполняется либо ничем, либо планетой (планеты должны заполнять не менее
30% ячеек).

Космос бесконечен (возвращаясь на одно и тоже место каждый раз мы должны видеть те
же самые объекты).
Каждой планете случайно присваивается “рейтинг” от 0 до 10 000, который отображается
числом над планетой. При старте игры кораблю также присваивается рейтинг от 0 до 10
000.

Минимальная область видимости NxN ячеек, где N = 5, возможен зум, который
увеличивает до N = 10 000.
Начиная с N = 10 включается особый режим отображения объектов, при котором
отображается только P = 20 планет с самым близким к кораблю рейтингом в видимой
области.

В особом режиме объекты должны отображаться так, чтобы они всегда были видны на
экране независимо от их реального размера.
Требования к проекту:

#### Описание решения

При генерации мира был выбан подход с использованием шума Перлина.

При таком подходе достаточно сгенерировать одно стартовое значение. Далее при использовании этого стартового
значения можно получать один и тот же результат, что позволяет не хранить постоянно какую-либо информацию
в игровой сессии, кроме, собственно, стартового значения.

В игровой сессии генерируется двумерный массив 5х5 блоков пространства, игрок находится в центральном блоке.
При перемещении игрока в новый блок значения массива блоков обновляются.

Создание и обновление массива осуществляется с использованием асинхронных вызовов и параллельных циклов.
Текущий активный блок, в котором находится корабль игрока, отслежвается, изменение этого блока и запускает
процесс обновления массива пространства.

Блок содержит в себе двумерный массив ячеек 200х200.

Ячейка хранит в себе информацию о позиции в текущем блоке, позиции на глобальной сетке игрового мира и рейтинге.
Наличие ненулевого рейтинга подразумевает, что ячейка содержит планету.

Для определения видимых ячеек создается `Bounding Box` на основе `ortogonalSize` у камеры и проверяется
принадлежность ячейки к `Bounding Box`.

Процесс обновления ячеек с ближайшим к рейтингу корабля значением запускается асинхронно и в только в случае,
если изменились либо позиция корабля, либо `ortogonalSize` камеры, либо массив блоков пространства.

Для нахождения планет с ближайшим к космическому корабллю рейтингом используется `Max-heap`.

Объекты для отображения планет и рейтингов пуллятся при каждом пересчете ячеек с ближайшим к кораблю рейтингом.

#### Что можно улучшить/поменять/оптимизировать:

* Разбить процесс обновления блоков пространства по фреймам.
* Возможно, следует использовать `Unity Jobs` при обновлении блоков и пересчете ячеек с ближайшим рейтингом.
* Распареллеливание процессов вообще не самая моя глубокая область знаний, нужно поисследовать.
* Поработать над структурой игрового лупа и тем, как зависимости передаются сверху вниз. `GameManager` знает слишком много.
* Отрефакторить `GridController`, он берет на себя и обновление блоков пространства, и отрисовку.
* Избавиться от пула объектов, он тут оказался не нужен, достаточно создать нужное количество объектов при старте сессии и обновлять их.
